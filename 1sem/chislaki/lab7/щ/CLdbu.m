n=6

A=rand(n,n)

% d = [n:-1:1];
d = [(n-1)+0.000000000000000001,n-1:-1:1];
% d = [n+i,n-1:-1:n];
% d=rand(n,1)
[Q,R]=qr(A);
D=diag(d);
A=Q*D*Q'
A=newAA(n,d);

A_ist=A;
A_ist=[2.650883830244401 -0.377699919273977 0.098897076430068 -0.546747826361216 1.214170894485680 1.357359260832554
-0.377699919273977 3.375496520963176 0.382910481775178 0.571522327849884 0.394981223245313 0.192376004990082
0.098897076430068 0.382910481775177 3.387564375931120 0.808908246698252 -0.503949247381249 0.869738323426809
-0.546747826361216 0.571522327849884 0.808908246698252 3.915231732961160 0.207394998469334 0.006438142817693
1.214170894485680 0.394981223245313 -0.503949247381249 0.207394998469334 3.642687802253179 0.160104735082112
1.357359260832554 0.192376004990082 0.869738323426809 0.006438142817693 0.160104735082112 3.028135737646964]
% A_ist=[-0.721612862354653,-0.597134706023578,0.234174789099567,0.168428137692302,1.35980393676434,0.313615080731425;-0.597134706023578,-2.34708092397503,0.910304929472178,0.195382219971205,0.326874723375152,0.223971188524913;0.234174789099567,0.910304929472178,0.578938320140407,-0.254568920191462,-0.0219163623546041,-0.157293618332269;0.168428137692302,0.195382219971205,-0.254568920191461,-1.38338435965876,0.710746201207997,0.110611065677779;1.35980393676434,0.326874723375152,-0.0219163623546040,0.710746201207997,-0.897583249048286,0.149568315907292;0.313615080731425,0.223971188524913,-0.157293618332269,0.110611065677779,0.149568315907292,-0.0249232382033240]
% A_ist=[3.41099485649529,-0.597134706023578,0.234174789099567,0.168428137692302,1.35980393676434,0.313615080731425;-0.597134706023578,1.78552679487491,0.910304929472178,0.195382219971205,0.326874723375152,0.223971188524913;0.234174789099567,0.910304929472178,4.71154603899035,-0.254568920191462,-0.0219163623546041,-0.157293618332269;0.168428137692302,0.195382219971205,-0.254568920191461,2.74922335919118,0.710746201207997,0.110611065677779;1.35980393676434,0.326874723375152,-0.0219163623546040,0.710746201207997,3.23502446980166,0.149568315907292;0.313615080731425,0.223971188524913,-0.157293618332269,0.110611065677779,0.149568315907292,4.10768448064662]% -0.379062209619509 1.053933509835907 -0.204932740806499 3.717827318782075 0.496463723482475 0.807864172914058
% 1.004006105371168 -0.361700383851612 0.871438069056726 0.496463723482475 3.149726566194820 0.838808370628160
% -0.436422456585815 -0.205181876913116 -0.404795381128493 0.807864172914058 0.838808370628160 3.494904350910692];
% A_ist=[6.44290946604364,-0.741292403651852,-0.0741176768814553,0.602833156229563,-0.527711623158972,0.775944010635531,-0.253211737549510,0.711116486867905,0.936499698624716,1.14161920454989;-0.741292403651852,5.78898541061575,1.12884727092028,0.646520786779948,-0.642859361238153,1.34529167631798,0.865600022249249,-0.579237316575605,-0.177188023454057,0.0998075759095723;-0.0741176768814551,1.12884727092028,5.97483068680012,-0.697695823920929,1.01444584193640,0.560006669550171,0.643070533051403,0.313328209338645,0.923216051419097,0.776839287792526;0.602833156229563,0.646520786779949,-0.697695823920929,5.08631004739795,-0.266509688159357,-0.202460723773729,0.586867504190486,0.475601185223558,1.72579411631717,0.248509894367933;-0.527711623158972,-0.642859361238153,1.01444584193640,-0.266509688159357,5.19185655089952,-0.403170062208656,1.31205246130383,2.17138940077039,0.525263037073179,0.165570763250758;0.775944010635531,1.34529167631798,0.560006669550171,-0.202460723773729,-0.403170062208656,7.20778141421121,0.847738790516886,0.189119292171260,-0.605848548328212,0.0593830278722846;-0.253211737549510,0.865600022249249,0.643070533051403,0.586867504190486,1.31205246130383,0.847738790516886,4.92724621561592,-0.421079156848095,-0.384874940698374,-0.00554050724056569;0.711116486867904,-0.579237316575605,0.313328209338645,0.475601185223558,2.17138940077039,0.189119292171260,-0.421079156848095,6.30266749512211,0.421222382023803,-0.566421037228669;0.936499698624716,-0.177188023454057,0.923216051419098,1.72579411631717,0.525263037073180,-0.605848548328212,-0.384874940698374,0.421222382023803,4.27308001023320,2.05575995230312;1.14161920454989,0.0998075759095722,0.776839287792526,0.248509894367933,0.165570763250758,0.0593830278722847,-0.00554050724056565,-0.566421037228669,2.05575995230312,2.80433270306057]
%%плохо отделимые
% A_ist=[4.62455840089633,1.11434378008840,0.0214279779713255,0.156928871392536,-0.683018893582087,0.936224219484750,2.10882107283802,-0.675668886691762,0.368747585598953,0.121208065254996;1.11434378008840,5.46045111850096,-0.502662002592885,-0.0108336569759513,0.283532979883051,0.522331326316894,-0.163225982252121,0.967450560925653,0.595931980158685,-0.628323187614764;0.0214279779713255,-0.502662002592885,5.25840092024554,0.903749812906905,1.97382189094197,0.549174148702192,0.509819331662368,-0.818819560579402,0.341720401973130,0.0110825757841702;0.156928871392536,-0.0108336569759512,0.903749812906905,4.92169780451715,0.688202637208589,-0.969997440680056,-0.161002311098767,1.22968177369042,-0.176683913218296,1.45515903950391;-0.683018893582087,0.283532979883051,1.97382189094197,0.688202637208589,6.65948796229728,0.830140693763449,0.0827320603329084,0.254750265727453,0.105928156426777,0.193861173734122;0.936224219484750,0.522331326316894,0.549174148702192,-0.969997440680055,0.830140693763449,7.14842102311086,0.642359883559785,-0.323403658730826,-0.438494769227914,-0.182266464191808;2.10882107283802,-0.163225982252121,0.509819331662368,-0.161002311098767,0.0827320603329086,0.642359883559785,4.06070194630804,-0.683589755705607,1.47458837891310,1.43364235862231;-0.675668886691762,0.967450560925653,-0.818819560579402,1.22968177369042,0.254750265727453,-0.323403658730826,-0.683589755705607,5.45659964889737,1.80367563307842,1.49508054708377;0.368747585598953,0.595931980158685,0.341720401973130,-0.176683913218296,0.105928156426777,-0.438494769227913,1.47458837891310,1.80367563307842,4.47576223017410,-0.315935413812368;0.121208065254996,-0.628323187614764,0.0110825757841705,1.45515903950391,0.193861173734122,-0.182266464191808,1.43364235862231,1.49508054708377,-0.315935413812368,5.93391894505237]
% A_ist=[5.51824022322552,-0.650484007446300,0.892025304814470,-0.161076646534553,1.55038499481265,0.644463213631160,-0.178635252658225,0.862475325630966,0.229447996717543,1.92456495982636;-0.650484007446300,4.92099965005013,-0.0480536655734751,-0.301626443236896,0.756563499773313,-0.530146755801304,1.97201089630657,0.307255054944670,0.00782133442739963,1.37399353239355;0.892025304814470,-0.0480536655734751,5.88051268983808,0.537679086261230,0.761048417042400,0.636812685737989,-0.329866740123142,1.68034648787646,-0.399197219503724,-0.689925661596744;-0.161076646534553,-0.301626443236896,0.537679086261230,6.19527150263393,1.13718853734319,-1.24365072575797,1.02222479772974,1.12160027114064,0.225370442401033,-0.256110864138884;1.55038499481265,0.756563499773313,0.761048417042400,1.13718853734319,5.11809555218820,-1.10376711891751,1.03125281475627,-0.226062628374634,-0.973940939367273,-0.221012773072092;0.644463213631160,-0.530146755801304,0.636812685737990,-1.24365072575797,-1.10376711891751,6.83057057373752,0.605029790413363,1.08425333986714,0.315326305092823,0.358437644528635;-0.178635252658225,1.97201089630657,-0.329866740123142,1.02222479772974,1.03125281475627,0.605029790413363,4.62027029543432,0.197036104026662,1.10400194778297,-0.706553770837297;0.862475325630966,0.307255054944670,1.68034648787646,1.12160027114064,-0.226062628374634,1.08425333986714,0.197036104026661,4.63125124324226,-0.0146606370570403,0.211645069579626;0.229447996717543,0.00782133442739966,-0.399197219503724,0.225370442401033,-0.973940939367273,0.315326305092823,1.10400194778297,-0.0146606370570403,4.76239243332309,1.53531095577176;1.92456495982636,1.37399353239355,-0.689925661596744,-0.256110864138884,-0.221012773072092,0.358437644528635,-0.706553770837297,0.211645069579626,1.53531095577176,5.52249583632695]
%%хорошо отделимые
% A_ist=[12.8313398706136,5.07558025737724,1.94153607727703,6.96193094044007,2.69860640077896,7.80236892551030,5.00524605711699,8.22699312003473,9.12792226414465,2.29860410008702;8.57160725512937,8.19613159648178,-3.05476752447438,-0.638965435319541,2.67870154934285,5.34920829283783,2.72928387184293,1.72784065730638,8.31390426909775,-3.26670072777348;10.5148956273745,6.12193625945922,7.21223501903299,5.55045261960869,9.20680763975849,9.23114440072230,2.96954453424968,9.50899662402518,5.33765066634794,4.00511521944365;9.45114229990008,-2.67232725521636,-9.00567414460712,-5.39162196349174,2.54845398297497,-5.50429519590736,-4.35458018500512,-10.8315806226039,5.17065099850708,-5.03341154475615;-5.15456526155386,-7.80719833812774,-8.29566304690725,-13.7740427878787,2.08742842788984,-12.3694039480370,-7.73900112123904,-14.1337925765974,-6.75445065186344,-7.64703088639993;-6.21076972159965,1.16280611977176,5.10630717254977,4.50805780596399,-2.98703866874465,6.10400013804802,2.67860590908823,3.89368555387419,-3.40352740370920,2.84432816845418;-3.67010591900626,-0.862332309922552,3.29624073952821,1.09046401470000,-1.68860308430631,-0.713124964841318,7.05721639169024,-2.15673199423202,-2.58262924846750,1.47845517484381;-0.988383170827544,1.31195934597799,2.12159117653199,3.95172447268335,-0.666090601861913,2.73648972859098,0.372458674063947,9.71004561745847,0.113939341284582,1.93958654016045;-4.44211048785465,-2.90989736644254,-2.11229047698406,-3.56455007287174,-0.933212490775611,-4.74657007071399,-4.32873328299833,-2.92087171801603,-1.31672176787610,-1.20242225193216;-17.8845748994547,-3.49109616625743,7.71294401320651,5.33199747479508,-8.94864988047947,-3.91964288252013,0.522559819502913,1.13891708795858,-10.7532729326777,8.50994667015284]
% A_ist=[588.039238310467,603.278528428542,358.467981479760,683.924597064169,158.840386577349,524.271904876780,352.292546002619,805.239653046463,389.821461532685,966.558466182191;-217.227598225659,-217.496033031204,-134.160717252582,-256.377229658177,-63.2376852895833,-198.426781949673,-129.919824551365,-300.114933721385,-148.541529882995,-361.616407540393;223.912561719739,231.204726562438,143.986298231926,265.646046743159,61.4261607405957,203.012254691714,132.581490246196,311.910137426056,150.072601995803,373.267326850419;889.753397681335,922.057701061447,546.737024858211,1045.18894763408,225.334341557664,795.570061477020,528.136828808711,1225.61319365213,581.829217245045,1473.37441719625;478.479039345465,495.859610404442,293.475597753675,557.223112343483,126.476319055721,425.762217004293,285.731254867076,657.624088637296,313.149208949452,789.192596548021;550.670198539907,569.305159406446,337.537464618856,643.013240879823,139.252306782397,498.412643234736,325.733814943055,757.141435994276,359.826368761707,912.419175840784;474.850223997101,490.037027080080,290.889010521715,556.774594874991,125.316927211186,425.430915589700,286.833362185121,653.949698857349,314.488262998716,785.862136781411;-455.763740800916,-472.050020714420,-279.327144565148,-530.745325463998,-113.918331588872,-408.302242593251,-270.610408011228,-620.470406009247,-297.652386114114,-753.595944223259;-1237.10275573909,-1280.54077554260,-759.327626873723,-1449.98290748802,-319.098322942020,-1106.56899590122,-735.909652303892,-1706.99108806514,-808.185106660304,-2049.63372545554;-600.490537353546,-622.893389089470,-369.539634040220,-701.962773648992,-155.961855063592,-537.592302159269,-358.057586005645,-828.398159551014,-394.878067253608,-988.785162951299]
figure
LUU(A_ist,'обычная матица')

LUU_sdvig(A_ist,'со сдвигом обычная матица со сдвигом')

LUU(Hess(A_ist),'приведеная к Хессенбергу методом вращений')

LUU_sdvig(Hess(A_ist),'со сдвигом приведеная к Хессенбергу методом вращений')

legend('обычная матица','со сдвигом обычная матица со сдвигом','приведеная к Хессенбергу методом вращений','со сдвигом приведеная к Хессенбергу методом вращений')
% figure
% LUU(A_ist,'обычная матица')
% LUU(Hess(A_ist),'приведеная к Хессенбергу методом вращений')
% legend('обычная матица','приведеная к Хессенбергу методом вращений')
% figure
% LUU_sdvig(A_ist,'со сдвигом обычная матица со сдвигом')
% LUU_sdvig(Hess(A_ist),'со сдвигом приведеная к Хессенбергу методом вращений')
% legend('со сдвигом обычная матица со сдвигом','со сдвигом приведеная к Хессенбергу методом вращений')
function new_A=newAA(n,d)
    A=rand(n,n);
    [Q,R]=qr(A);
    D=diag(d);
    A=Q*D*Q'
    while true
        disp('ищу матрицу под условия применимости')
        if det(A)~=0
            de=1;
            for k=0:(n-1)
                M=A(1:k,1:k);
                de=de*det(M);
            end
            if de~=0
                new_A=A;
                return
            else
                A=rand(n,n);
                [Q,R]=qr(A);
                D=diag(d);
                A=Q*D*Q';
            end
        else
                [Q,R]=qr(A);
                D=diag(d);
                A=Q*D*Q';
        end
        
    end
    new_A=A;
end
function LULULU=LUU_sdvig(A,tit)
n = length(A);
if det(A)==0
    disp('det=0')
    return
end
for i=0:n-1
    Minor=A(1:i,1:i);
    if det(Minor)==0
        disp('найден нулевой минор')
        return
        break
        
    end
end

EPS = [];
K = [];
n = length(A);
V= [];
A_ist1=A;
% eps2=10^(-1)
for t = 1:13
    eps2 = 10^-t;
    k1 = 0;
    A = A_ist1;
    up=0;
    up0=0;
    %%%%%%%%%%%%%%
    A0=A;
    M0=A0(n-1:n,n-1:n);
        U=eig(M0);
        if real(U(1))~=U(1) || real(U(2))~=U(2)
            if abs(real(U(1))-A0(n,n))>abs(real(U(2))-A0(n,n))
                u0=real(U(2));
            else
                u0=real(U(1));
            end
        else
            if abs(U(1)-A0(n,n))>abs(U(2)-A0(n,n))
                u0=U(2);
            else
                u0=U(1);
            end
        end
        %%%%%%%%%%
        if abs(u0/up0-1)<1/2 || up0==0
        v0=u0*eye(n);
        up0=u0;
        A0=A0-v0;
        [L0,R0] =Lu(A0);
        A = R0*L0+v0;
         else
            [L0,R0] =Lu(A0);
            A = R0*L0;
        end
    %%%%%%%%%%%%%
        dd1=diag(A0);
    while max(tril(A,-1),[],'all')>eps2 
        diagu=diag(A);
        u1=(diagu(2)+diagu(n))/2;
%         u=+diagu(n-1)+diagu(n-2)
        %%%%%%%%%%сдвиг
        M=A(n-1:n,n-1:n);
        U=eig(M);
        if real(U(1))~=U(1) || real(U(2))~=U(2)
            if abs(real(U(1))-A(n,n))>abs(real(U(2))-A(n,n))
                u=real(U(2));
            else
                u=real(U(1));
            end
        else
            if abs(U(1)-A(n,n))>abs(U(2)-A(n,n))
                u=U(2);
            else
                u=U(1);
            end
        end
        %%%%%%%%%%
        if abs(u/up-1)<=1/2 || up==0 
        v=u*eye(n);
        v1=u1*eye(n);
        up=u;
        A=A+v;
        [L,R] =Lu(A);
        A = R*L-v
        else
            [L,R] =Lu(A);
            A = R*L
        end
        
         dd2=diag(A);
        dA = abs(abs(dd1(1)) - abs(dd2(1))); 
        if dA<eps
            break
        end
        k1 = k1+1;
%          if k1>1000
%             break
%         end
    end
    EPS = [EPS, eps2];
    K = [K,k1];
  
end
A
semilogx(EPS,K)
hold on
grid on


end
function LULULU=LUU(A,tit)
EPS = [];
K = [];
n = length(A);
V= [];
A_ist1=A;
% eps2=10^(-1)
for t = 1:13
    eps2 = 10^-t;
    k1 = 0;
    A = A_ist1;
    while max(tril(A,-1),[],'all')>eps2 
        [L,R] =Lu(A);
        A=R*L
        k1 = k1+1;
%         if k1>1000
%             break
%         end
    end
%     A=hess(A)
    EPS = [EPS, eps2];
    K = [K,k1];
end
A
semilogx(EPS,K)
hold on
grid on


end
function [L,R]=Lu(A)
        n = length(A);
        L = eye(n);
        R = eye(n);
        for m = 1:n
            S1 = 0;
            S2 = 0;
            for j = m:n 
                for k = 1:m-1
                    S1 = S1+L(m, k)*R(k, j);
                end
                R(m, j) = A(m, j)-S1;
                S1 = 0;
            end

            for i = m+1:n
                for k = 1:m-1
                    S2 = S2+L(i, k)*R(k, m);
                end
                L(i, m) = (A(i, m)-S2)/R(m,m);
                S2 = 0;
            end
        end 
       
end
function Hess1 = Hess(A)
n = length(A);
for i=2:n-1
        for j=i+1:n
        c = A(i,i-1)/((A(i,i-1))^2 + (A(j,i-1)^2))^(1/2);
        s = A(j,i-1)/((A(i,i-1))^2 + (A(j,i-1)^2))^(1/2);
        G = eye(n);
        G(i,i) = c;
        G(j,j) = c;
        G(i,j)= -s;
        G(j,i) = s;
        A = G'*A*G;        
        end
end
Hess1=A;
end