n=10
B=rand(n,n);
n = length(B);
xp = ones(n,1);
L1 = ones(n,1);
L2 = xp+L1;

d1 = [1,2,3,4,5,6,7,8, 9, 10]; %хорошо отделимые корни
D1 = diag(d1);
[Q1,R1] = qr(B);
% A = Q1.'*D1*Q1;
A=[5.11162517802091,-1.01814303787990,0.667328425737625,0.181876231142851,0.856353775110019,0.0209319480260176,-0.659522508945274,0.874434450524666,0.268691442839358,-1.32521117857281;-1.01814303787990,3.02502235708366,0.365360755408480,0.121736171380408,0.0624736438613405,0.657925254602040,-0.425284764312087,-0.993277491797609,-0.133692869096816,2.38648518931090;0.667328425737625,0.365360755408480,4.33216358987762,-0.0962489090386861,0.000703600229751389,-0.141362294791853,-0.263870889386456,-0.604655926688518,0.160261575868604,-1.43923396822710;0.181876231142851,0.121736171380408,-0.0962489090386862,7.02347591587133,0.0321022774788507,0.667494046813333,-0.0499993608759151,-1.54526568335201,-0.858839261314242,0.284034402543791;0.856353775110019,0.0624736438613406,0.000703600229751433,0.0321022774788508,4.81915434182918,-0.400341874891844,1.11237113265455,0.884131532422557,-1.47870885143637,0.835175840472698;0.0209319480260180,0.657925254602040,-0.141362294791853,0.667494046813333,-0.400341874891844,5.58124156041399,0.143547339154788,0.143719197293882,2.23451454767012,0.729665638709082;-0.659522508945274,-0.425284764312087,-0.263870889386456,-0.0499993608759152,1.11237113265455,0.143547339154788,7.25157498782052,1.33104068465504,0.231066095975903,0.490392180556687;0.874434450524666,-0.993277491797609,-0.604655926688518,-1.54526568335201,0.884131532422557,0.143719197293882,1.33104068465504,6.71212035794134,-1.41743840110485,-0.160742693999930;0.268691442839358,-0.133692869096816,0.160261575868604,-0.858839261314241,-1.47870885143637,2.23451454767012,0.231066095975903,-1.41743840110485,5.41517278598569,0.214625979565784;-1.32521117857281,2.38648518931090,-1.43923396822710,0.284034402543791,0.835175840472698,0.729665638709082,0.490392180556687,-0.160742693999930,0.214625979565784,5.72844892515577];

d = [1,2,3,4,5,6,7,8, 9, 9.00000000000001]; %плохо отделимые корни
D = diag(d);
[Q,R] = qr(B);
A1 = Q.'*D*Q;
A1=[5.08067100430162,-0.979313650636873,0.672442200650227,0.235665620871740,0.804224660971194,0.0691546060194189,-0.720965021869918,0.764089087403457,0.328646263107792,-1.29390445280020;-0.979313650636873,2.97631418198127,0.358945958226175,0.0542619411751451,0.127865199064475,0.597434017520595,-0.348210339739452,-0.854858586678017,-0.208901109329644,2.34721355539942;0.672442200650228,0.358945958226175,4.33131877023896,-0.105135168909624,0.00931557477369335,-0.149328904429117,-0.253720297611316,-0.586426354328796,0.150356757909041,-1.44440598639511;0.235665620871740,0.0542619411751451,-0.105135168909624,6.93000553369786,0.122687581485443,0.583697032294631,0.0567699331003003,-1.35351739778872,-0.963023376283342,0.229632379443779;0.804224660971194,0.127865199064475,0.00931557477369339,0.122687581485444,4.73136506450775,-0.319131358164377,1.00889740409468,0.698301793241036,-1.37774050715788,0.887898678301075;0.0691546060194192,0.597434017520595,-0.149328904429117,0.583697032294631,-0.319131358164377,5.50611680453982,0.239266944332735,0.315623211117882,2.14111257806566,0.680893749544255;-0.720965021869918,-0.348210339739452,-0.253720297611316,0.0567699331003001,1.00889740409468,0.239266944332735,7.12961462057795,1.11201056415391,0.350073466440521,0.552534491973433;0.764089087403457,-0.854858586678017,-0.586426354328796,-1.35351739778872,0.698301793241036,0.315623211117882,1.11201056415391,6.31876147610620,-1.20371160376301,-0.0491405541772645;0.328646263107792,-0.208901109329644,0.150356757909041,-0.963023376283342,-1.37774050715788,2.14111257806566,0.350073466440521,-1.20371160376301,5.29904691210459,0.153988304856330;-1.29390445280020,2.34721355539942,-1.44440598639511,0.229632379443779,0.887898678301075,0.680893749544256,0.552534491973433,-0.0491405541772645,0.153988304856330,5.69678563194400];
w = eig(A);
w1 = eig(A1);

solGood = lab6(A, xp, L1, L2); %хорошо отделимые корни
solBad = lab6(A1, xp, L1, L2); %плохо отделимые корни

function [wm] = lab6(A, xp, L1, L2)
n = length(A);
xn = A*xp;
np = norm(xp, inf);
xp1 = xp/np;
xp2 = xp/np;
xn1 = A*xp1;
nn = norm(xn1,inf);
xn1 = xn1/n;

Eps = [];
Err = [];
err = 10;
K = [];
K1 = [];

k = 0;
k1 = 0;

Err = [Err,( L2-L1)];
for e = 3:15
    eps = 10^-e;
    while max(Err)>eps
        xp = xn;
        xn = A*xp;
        Err = [];
        for i = 1:n
            L1(i) = L2(i);                  %Без нормировки
            L2(i) = xn(i)/xp(i);
            Err = [Err, abs(L2(i)-L1(i))];
        end
        k = k+1;
    end
 disp(L1)
 errrrr=err
    while errrrr>eps
        xn1 = A*xp2;
        nn = norm(xn1,inf);
        xp2 = xn1/nn; 
% %         err  = abs(np-nn);
        errrrr=norm(nn-np)/norm(np);
        np = nn;                            %С нормировкой
        k1 = k1+1;
    end

    Eps = [Eps, eps];
    K = [K, k];
    K1 = [K1, k1];
end
disp(nn)
disp(eig(A))
wm = nn;
figure 
semilogx(Eps, K, '-r*')
hold on
grid on
semilogx(Eps,K1, '-b*')
title('Зависимость числа итераций от точности')
legend('Без нормировкой', 'С нормировкой')
xlabel('Эпсилон')
ylabel('Число итераций')
end

