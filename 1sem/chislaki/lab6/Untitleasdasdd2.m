n=5
A =rand(n,n);
A=[1.43322109803814,0.00209397012585013,0.133544377714551,0.137678873190195,0.456887973796413;0.00209397012585013,1.99032275382563,0.0522461877523039,-0.0824103374109570,0.00762132030068798;0.133544377714551,0.0522461877523039,1.04385495821882,0.0381120719645597,0.141121953909356;0.137678873190195,-0.0824103374109570,0.0381120719645597,1.05072383183220,0.144746187693895;0.456887973796413,0.00762132030068798,0.141121953909356,0.144746187693895,1.48187735808521]
d=[1,2,1,2,1];
% A=(A+A')/2
% A=[1.41617389846435,0.370691914371205,0.324901045429444;0.370691914371205,1.33018047476603,0.289393907104349;0.324901045429444,0.289393907104349,1.25364562676962]
[Q,R]=qr(A);
% A=[1.41617389846435,0.370691914371205,0.324901045429444;0.370691914371205,1.33018047476603,0.289393907104349;0.324901045429444,0.289393907104349,1.25364562676962]
% d=[1,2,1];
% d=[1,2,1,3,4,5,6,8,5];
D=diag(d);
A=Q.'*D*Q
% A= triu(A) + triu(A)' ;
% A=[-0.211737693547967,-0.0149712739655528,-0.0458067374941472,-0.00335657082808317,-0.0102908758843117;-0.0149712739655528,0.142835068499625,-0.00501257585251374,0,0.0190874873657498;-0.0458067374941472,-0.00501257585251374,-0.515366252422668,0.00415562129262023,0.0697382065661840;-0.00335657082808317,0,0.00415562129262023,2.41091445261907,0.000967006095953129;-0.0102908758843117,0.0190874873657498,0.0697382065661840,0.000967006095953129,0.537475222492748]
% A=[0.928290602532009,0.705298883625204,0.564804170436251,0.411008337527285,0.329653366015608;0.705298883625204,0.178854842754043,0.464437706628942,0.296404684297969,0.270682054417032;0.564804170436251,0.464437706628942,0.876322377457804,0.687845788475593,0.110294976047507;0.411008337527285,0.296404684297969,0.687845788475593,0.206605120825905,0.226727455831516;0.329653366015608,0.270682054417032,0.110294976047507,0.226727455831516,0.136112429227215]
eps=10^(-7);
% SI=[]
% CO=[]
A_ist=A
o=0
% S1=0
% S2=0
% for i=1:n
%     S1=S1+(D(i,i))^2;
%     for j=1:n
%         S2=S2+K(i,j)^2;
%     end
% end
L=eye(n)
while o~=10000
    o=o+1
    B=A;
    D=diag(diag(B));
    K=B-D
    L2=L;
    S1=0;
    S2=0;
    for i=1:n
        S1=S1+(D(i,i))^2;
        for j=1:n
            S2=S2+K(i,j)^2;
        end
    end
% S1=norm(D,'fro');
% S2=norm(K,'fro')

    r=zeros(1,n);
    for i=1:n
        for j=1:n
           r(i)=r(i)+(K(i,j))^2;
        end
    end
    if max(r)<eps
        break
    end
    if S2<eps
        break
    end
    [rmax,j]=max(r);
    [xmax,i]=max(abs(K(j,1:n)));
    %%находим косинусы и синусы
%     for i=1:n
%         for j=1:n
            if A(j,j)==A(i,i)
                theta = pi/4;
                c = cos(theta);
                s = sin(theta);
            else
%                 tg = (2*A(i,j))/(A(i,i)-A(j,j)) ;
%                 c2 = 1/(1+tg^2) ;
%                 c=sqrt(c2);
%                 s = sqrt(1-c2);
%                 tg = (2*A(i,j))/(A(i,i)-A(j,j)) ;
%                 c=cos(1/2*atan(tg));
%                 s=sin(1/2*atan(tg));
%                 SI=[SI,s]
%                 if s==0
%                     break
%                 end
%                 CO=[CO,s]
%%%%%%%%%%%%%%
%                   tau = (A(j,j)-A(i,i))/2/A(j,i) 
%                   t = sign(tau)/(abs(tau)+sqrt(1+tau^2)) 
%                   c = 1/sqrt(1+t^2) 
%                   s = c*t
%%%%%%%%%%%%%%%%%
                    tg = (2*A(i,j))/(A(i,i)-A(j,j)) ;
                    c2=1/sqrt(1+tg^2)
                    c=sqrt((1+c2)/2)
                    s=sign(tg)*sqrt((1-c2)/2)

            end
%         end
%     end
    %%применяем вращения
%     for i=1:n
%         for j=1:n
            B(i,i)=c^2*A(i,i)+s^2*A(j,j)+2*c*s*A(i,j);
            B(j,j)=s^2*A(i,i)+c^2*A(j,j)-2*c*s*A(i,j);
%             B(j,i)=(c^2-s^2)*A(j,i)+s*c*(A(i,i)-A(j,j))
            B(j,i)=0;
            B(i,j)= B(j,i);
            for m=1:n
                if (m~=i) && (m~=j)
                    B(i,m)=c*A(m,i)+s*A(m,j);
                    B(m,i)=B(i,m);
                    B(j,m)=-s*A(m,i)+c*A(m,j);
                    B(m,j)=B(j,m);
                    
                end
%                 L2(m,i)=c*L(m,i)-s*L(m,j)
%                 L2(m,j)=s*L(m,i)+c*L(m,j)
            end
%%%%%%%%%%%%%%%%%%%%%%%
%             B(i,i)=c^2*A(i,i)+s^2*A(j,j)+2*c*s*A(j,i);
%             B(j,j)=s^2*A(i,i)+c^2*A(j,j)-2*c*s*A(j,i);
%             B(j,i)=(c^2-s^2)*A(j,i)+s*c*(A(i,i)-A(j,j));
%             B(i,j)= B(j,i);
%             for m=1:n
%                 if (m~=i) && (m~=j)
%                     B(j,m)=c*A(j,m)-s*A(i,m);
%                     B(m,j)=B(j,m);
%                     B(i,m)=s*A(j,m)+c*A(i,m);
%                     B(m,i)=B(i,m);
%                     
%                     for l=1:n
%                         B(m,l)=A(m,l)
%                     end
%                 end
%             end
%%%%%%%%%%%%%%%%%%%%%%
%         end
%     end
    L=L2;
    A=B;
end
diag(A)
% L
% G=L'*L
eig(A_ist)