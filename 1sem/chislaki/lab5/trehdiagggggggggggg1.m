n=6
B = randn(n,n)
C = randn(n,n)
A=zeros(n)
del=0.000000001
delta=0.00001

%%%%%%%%%%%%%%%%%%% трехдиагональная симметричная
% [Q,r]=qr(C);
% d=[10,5,5.00001,3,3.001,1];
% D=diag(d);
% A=Q*D*Q'
% A=hess(A)

% A=[5.39196272511414,-3.73054327723977,-1.42576303646350e-16,1.03994787893004e-16,-4.28105671776932e-16,-1.95550720427755e-17;-3.73054327723977,6.17162203263799,-2.17696363425035,3.95857628339264e-16,-9.62287332394909e-16,1.04179056457927e-16;0,-2.17696363425035,3.92102867568112,-1.18159365479609,1.07458445715474e-16,-3.08227488637920e-16;0,0,-1.18159365479609,3.51623394764585,0.000470589998477644,5.24005975838572e-16;0,0,0,0.000470589998477854,3.00032770146301,0.0182030191918559;0,0,0,0,0.0182030191918558,4.99983491745789]
% left=[9.99999000000003,4.99999999984981,4.99999000015003,3.00999000011081,2.99998999988930,0.999990000000002]
% right=[10.0000100000000,5.00001999984981,5.00001000015002,3.00001000011081,3.00000999988930,1.00001000000000]

% %%%%%%%%%%%%%%%%%%%%%%%%%%% несимметричная

% for i=-1:1
%     A=A+diag(diag(B,i),i)
% end

% A=[-2.08104954953813,-0.588468576587009,0,0,0,0;-0.0447531285251478,-0.0239246601871600,-0.00588048281891479,0,0,0;0,2.19131300989467,0.281389082113301,0.603656417784618,0,0;0,0,-0.251339244970154,2.22096535608252,-0.127525014127046,0;0,0,0,-1.65413062939858,0.680361843968248,-1.11237866030638;0,0,0,0,0.426214596812093,-0.722041773268244]
A=[-0.527776960816186,-1.84425289591556,0,0,0,0;1.24160125135253,0.288409809703686,0.272066496438054,0,0,0;0,-0.950911127513204,-1.16853089383044,0.501327534308470,0,0;0,0,-1.22423430692922,0.540313745697744,-0.664853402867584,0;0,0,0,0.990750986531975,1.45274196098984,-0.125016775948650;0,0,0,0,1.37984575214444,-0.530466700307261]
left=[-0.149695943705368 + 1.54526586012908i,-0.149695943705368 - 1.54526586012908i,0.798577644439880 + 0.678067534272878i,0.798577644439880 - 0.678067534272878i,-0.736226087962105 + 0.00000000000000i,-0.506906352069538 + 0.00000000000000i]
right=[-0.149675943705368 + 1.54526586012908i,-0.149675943705368 - 1.54526586012908i,0.798597644439880 + 0.678067534272878i,0.798597644439880 - 0.678067534272878i,-0.736206087962105 + 0.00000000000000i,-0.506886352069538 + 0.00000000000000i]
% 
% %%%%%%%%% симметричная
% A=diag(diag(B))
% A=A+diag(diag(B,1),1)
% A=A+diag(diag(B,1),-1)
% if det(A)==0
%     display("DET=0")
% end

% A=[1.19210187053127,0.00116208348351385,0,0,0,0;0.00116208348351385,-0.0708372131604802,-0.948480983570505,0,0,0;0,-0.948480983570505,0.411490621423374,0.826069998469923,0,0;0,0,0.826069998469923,0.536157079925919,-0.504586405514010,0;0,0,0,-0.504586405514010,-1.27059444980866,0.137024874130050;0,0,0,0,0.137024874130050,-0.291863375753573]
% left=[1.62446844858630,1.19209228762389,-1.46300755202805,-0.938474245432236,0.368153453926706,-0.276837859518760]
% right=[1.62448844858630,1.19211228762389,-1.46298755202805,-0.938454245432236,0.368173453926706,-0.276817859518760]
%%%%%%%%

syms x;
g=det(A-x*eye(n))
f=expand(dl(n,A))

R=roots(poly(A))
R1=[]
t=1
% for i=1:length(R)
%     if imag(R(i))==0
%         disp('real')
%     else
%         R1(t)=R(i) 
%         t=t+1
%     end
% end
% R1
% h=f
% 
% for i=1:length(R1)
%   x = sym('x')
%   h1=h/(x-R1(i))
%   h1 = simplify(h1)
%   h=h1
%   i=i+1
% end

xt = [-5:0.1:10]
x_p = []
k = 1
t = length(xt)

for i = 2:t 
    if subs(h,x,xt(i))*subs(h,x,xt(i-1))<0 
        x_p(k) = xt(i)
        k = k+1
    end
end
X_p = []; 

for i = 1:length(x_p)
X_p = [X_p,x_p(i)+0.01]
end
sort(X_p)


Q=[]

for i=1:length(x_p)
    a=left(i);
%     x0=right(i);
    x0=X_p(i)
    x1=x0+del
    y0 = subs(f,x,x0);
    y1 = subs(f,x,x1);
    eps=10^(-4);
    n_iter=0;
    if subs(f,x,a)*subs(f,x,x0)<0 %переводим функцию в сабс подставляя в х а
         while abs(x1-x0)>eps
           t = x1-(x1-x0)*y1/(y1-y0) %формула для метода секущих
           y = subs(f,x,t)
           x0=x1; %назначаем вторую точку начальной
           y0=y1;
           x1=t; 
           y1=y;
           i=i+1;
         end

    end
     Q(i)=x1  
end
O=[]
t=1
for i=1:length(x_p)
    if imag(Q(i))==0
        O(t)=Q(i)
        t=t+1
    end
end



figure
hold on
x6 = -10:0.05:35;
axis([-3, 3, -5, 5])
plot(x6, double(subs(f, x6)))
X=O;
X=sort(O)
plot(O,0, 'r*')
title('Найденный полином')
MATL_roots=roots(poly(A)) 
% sort(MATL_roots)
figure
hold on
x6 = -10:0.05:35;
axis([-3, 3, -5, 5])
plot(x6, double(subs(g, x6)))
plot(MATL_roots,0,'b*')
title('Полином с пом. matlab')
X_p
if det(A)==0
    display("DET")
end

function detl1=dl(n,D)
    
    syms x;
    a=diag(D,-1);
    b=diag(D);
    c=diag(D,1);
    if n==0
        detl = 1;
    elseif n==1
        detl = b(1)-x;
    else
        detl = (-1)^(2*n)*(b(n)-x)*dl(n-1,D)+(-1)^(2*n-1)*a(n-1)*(-1)^(2*n-2)*c(n-1)*dl(n-2,D);
    end
    detl1=detl;
end

